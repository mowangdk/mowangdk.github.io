---
layout: post
title:  "weekly report"
date:   2022-11-13 22:30:08 +0800
categories: weeklyreport
---


# 读书

这周在杭州值班, 读书进展为0 


# 工作

这周主要是在出差, 不过也是收获满满.

### ext4 vs xfs 

- 之前遇到过 xfs 和 ext4 格式化写入数据的问题, 当时发现 xfs 与 ext4 在都开启日志的情况下, xfs 写入磁盘的数据库的量要少. 跟内核同学确认了下, 是因为二者使用的数据结构不同. ext4 使用的是标准的 inodemap & blockmap. 而 xfs 使用的是 Btree, 可以更高效的组织数据. 至于为啥 ext4 不升级底层的数据结构, 则是因为当时 ext4 需要向前兼容 ext3 的历史背景并且基于这个大背景下, 以后 ext4 可能也很难加什么高级的功能了, (当然默认xfs 不支持禁止日志写入)

- 当然因为 xfs 相对于 ext4 文件系统增加了很多的高级能力, 相对的整体稳定性也有影响.容易出比较多的问题. 但是内核和其他云厂商都在不断优化这一情况.相信后续可以不断优化这个文件系统

### copy 文件

copy 文件的时候数据块的量取决于文件内容的分布广度, 分布在越多的块上, 它 copy 的时间越长. 但是这一个特性是被隐藏的, 我们作为用户是没有办法控制这个行为, 所以暂时没有很好的优化方法. 相对好的方式只有 xfs reflink 特性了

### libvirt

Libvirt 为了构建云系统提供的一种虚拟化管理接口，通过在VIM层和VNFM层提供一个虚拟抽象层，提供统一API供上层调用，下层统一封装不同虚拟机，从而方便地实现对虚拟机的管理。
Libvirt是管理虚拟机、存储、网络的一系列软件集合。它包括了一个API库、一个daemon程序（libvirtd）和一个命令行工具(virsh).主要目标是为各种虚拟化工具提供一套统一可靠的API，让上层可以用一种单一的方式来管理多种不同的虚拟化技术。

它可以提供对虚拟机的生命周期管理, 多种设备的热插拔工作, 并且支持底层的多种虚拟化技术.

libvirt的一个节点内部划分如下，包括hypervisor和多个domains，每个domains表示一个客户机实例: hypervisor 可以管理这个节点内部的所有 domain




